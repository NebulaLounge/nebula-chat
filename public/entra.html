<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Entra nella NebulaLounge</title>
  <style>
    /* ...tutto il tuo CSS originale qui, invariato... */
    /* aggiungo solo uno stile per il preview */
    #nickpreview {
      font-size: 0.8em;
      color: #666;
      margin-top: -4px;
    }
  </style>
</head>
<body>

  <!-- HEADER -->
  <div class="header">
    <div class="header-title">💬 Chat NebulaLounge –
      <span class="header-subtitle">Dove tutto può iniziare 🛸</span>
    </div>
    <div class="menu-links">
      <a href="/">🔙 Torna su <em>Oltre la Verità</em></a>
      <a href="/chat">💬 Chat Gratis</a>
    </div>
  </div>

  <!-- COVER + TITOLO -->
  <div class="cover">
    <h1>Accedi alla NebulaLounge 🚀 Gratis</h1>

    <div class="container">
      <div class="banner">
        <a href="https://tc.tradetracker.net/?c=18031&m=2469548&a=432856&r=&u=" target="_blank" rel="sponsored nofollow">
          <img src="https://ti.tradetracker.net/?c=18031&m=2469548&a=432856&r=&t=html"
            width="300" height="250" alt="Happy Card Feltrinelli" />
        </a>
      </div>

      <input type="text" id="nickinput" placeholder="Nickname *" required />
      <div id="nickpreview"></div>
      <div id="infobox"></div>

      <input type="password" id="passwordinput" placeholder="Password (se registrato)" />

      <div class="select-row">
        <select id="sexselect" aria-label="Sono">
          <option value="">*Sono: ♂️ ♀️</option>
          <option value="M">👨‍💼 Uomo ♂️</option>
          <option value="F">👩‍🎓 Donna ♀️</option>
        </select>

        <select id="lookingselect" aria-label="Cerco">
          <option value="">*Cerco: ♀️ ♂️</option>
          <option value="F">👩 Donna ♀️</option>
          <option value="M">👨 Uomo ♂️</option>
        </select>
      </div>

      <input type="text" id="cityinput" placeholder="Città (opzionale)" />

      <button onclick="vaiAllaVerifica()">Entra in Chat</button>

      <div class="disclaimer">
        Accedendo accetti le <a href="disclaimer.html" target="_blank">regole di Simosnap</a>
      </div>
    </div>
  </div>

  <script type="module">
    import { sanitizeNick, isRegisteredNick } from "./utils.js";

    let registeredNicks = [];
    let welcomeMessage = "";

    const nickInput = document.getElementById("nickinput");
    const passwordInput = document.getElementById("passwordinput");
    const infoBox = document.getElementById("infobox");
    const nickPreview = document.getElementById("nickpreview");

    fetch("config.json")
      .then(response => response.json())
      .then(config => {
        registeredNicks = config.registeredNicks || [];
        welcomeMessage = config.welcomeMessage || "";
        infoBox.textContent = welcomeMessage;
      });

    nickInput.addEventListener("input", () => {
      const nickSanitized = sanitizeNick(nickInput.value);
      nickPreview.textContent = `Nick usato: ${nickSanitized}`;

      if (nickSanitized.length === 0) {
        infoBox.textContent = welcomeMessage;
        passwordInput.style.display = "none";
        return;
      }

      if (isRegisteredNick(nickSanitized, registeredNicks)) {
        passwordInput.style.display = "block";
        infoBox.textContent = "🔐 Nick registrato. Inserisci la password.";
      } else {
        passwordInput.style.display = "none";
        passwordInput.value = "";
        infoBox.textContent = "";
      }
    });

    window.vaiAllaVerifica = function () {
      const nick = sanitizeNick(nickInput.value);
      const sex = document.getElementById("sexselect").value;
      const looking = document.getElementById("lookingselect").value;
      const city = document.getElementById("cityinput").value.trim();
      const password = passwordInput.value;

      if (!nick || nick.length < 3) {
        alert("⚠️ Inserisci un nickname valido (minimo 3 caratteri).");
        return;
      }

      if (!sex || !looking) {
        alert("⚠️ Seleziona sesso e preferenza.");
        return;
      }

      localStorage.setItem("nick", nick);
      localStorage.setItem("sex", sex);
      localStorage.setItem("looking", looking);
      localStorage.setItem("city", city);
      if (password) localStorage.setItem("password", password);

      window.location.href = "join.html";
    };
  </script>

</body>
</html>
