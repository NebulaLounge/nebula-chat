<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Entra nella NebulaLounge</title>
  <style>
  body {
    background: linear-gradient(to bottom right, #003374, #001f4d);
    font-family: 'Segoe UI', sans-serif;
    margin: 0;
    color: #003374;
  }

  /* === MENU HEADER === */
.nav-wrapper {
  width: 100%;
  background-color: #003374;
  color: #fff;
  padding: 12px 16px;
  box-sizing: border-box;
  position: relative;
}

.nav-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-wrap: wrap;
}

.nav-title {
  font-size: 1.4em;
  font-weight: 600;
  color: #ea5906;
}

.header-subtitle {
  font-size: 0.75em;
  color: #ffffff;
}

.menu-links {
  display: flex;
  gap: 16px;
}

.menu-links a {
  color: #ffffff;
  text-decoration: none;
  font-size: 0.95em;
}

.nav-toggle {
  font-size: 1.5em;
  cursor: pointer;
}

.nav-logo {
  width: 40px;
  height: 40px;
  border-radius: 4px;
}

/* Desktop Menu */
.nav-menu {
  list-style: none;
  margin: 0;
  padding: 0;
  display: flex;
  gap: 20px;
  flex-wrap: wrap;
}

.nav-menu li a {
  color: #ffffff;
  text-decoration: none;
  font-size: 1em;
}

.desktop-only {
  display: flex;
  align-items: center;
  gap: 12px;
}

.mobile-only {
  display: none;
}
/* === MOBILE MENU STYLING ELEGANTE === */
@media (max-width: 768px) {
  .desktop-only {
    display: none;
  }

  .mobile-only {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 12px;
    width: 100%;
    background-color: #003374;
    position: relative;
    z-index: 1001;
    height: 15px;
  }

  .nav-toggle {
    font-size: 1.5em;
    color: #ffffff;
    cursor: pointer;
    padding: 6px;
  }

  .nav-title {
    font-size: 1.1em;
    font-weight: bold;
    color: #ea5906;
    text-align: center;
    margin: 0 auto;
  }

  .nav-logo {
    width: 36px;
    height: 36px;
    border-radius: 6px;
  }

  .nav-menu {
    position: absolute;
    top: 55px;          /* Margine superiore ridotto */
    left: 10px;         /* Spostato tutto a sinistra */ 
    width: 180px;       /* Larghezza menu ridotta */
    background: white;
    border-radius: 12px;
    border: 2px solid #ea5906;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    padding: 6px 10px;  /* Margini interni ridotti */
    display: none;
 /*   flex-direction: column; */
    z-index: 1000;
    animation: fadeIn 0.25s ease-out;
  }

  body.menu-open .nav-menu {
    display: flex;
  }

  .nav-menu li {
    list-style: none;
  }

  .nav-menu li a {
    display: block;
    padding: 10px 16px;
    font-size: 0.95em;
    color: #003374;
    text-decoration: none;
    transition: background 0.2s ease, color 0.2s ease;
    font-weight: 500;
  }

  .nav-menu li a:hover {
    background-color: #ea5906;
    color: #fff;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(-8px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
}
  /* === COVER SECTION === */
  .cover {
    background-image: url('https://www.indelibile.it/wp-content/uploads/2025/06/1a18e87e-a6ca-4c20-95ec-85cc2bd6a055-1024x576.png');
    background-size: cover;
    background-position: center;
    background-attachment: fixed;
    padding: 20px 16px 60px 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    text-align: center;
  }

  .cover h1 {
    color: #ffffff;
    text-shadow: 4px 4px 0px #000000;
    font-size: 35px;
    margin-bottom: 20px;
    margin-top: 10px;
  }

  /* === LOGIN BOX === */
  .container {
    background-color: rgba(255, 255, 255, 0.88);
    border-radius: 13px;
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
    text-align: center;
    padding: 18px 16px;
    max-width: 360px;
    width: 100%;
    margin-top: -10px;
    backdrop-filter: blur(4px);
  }

  .banner {
    background-color: #fff;
    border: 2px solid #003374;
    border-radius: 3px;
    width: 300px;
    margin: 4px auto 8px auto;
    box-sizing: border-box;
  }

  .banner img {
    display: block;
    width: 100%;
    height: auto;
    border-radius: 2px;
  }

  .select-row {
    display: flex;
    justify-content: space-between;
    gap: 10px;
    margin: 10px 0;
  }

  select,
  input[type="text"],
  input[type="password"] {
    flex: 1;
    padding: 8px 10px;
    font-size: 1em;
    border-radius: 6px;
    border: 1px solid #ccc;
    width: 100%;
    margin: 8px 0;
    box-sizing: border-box;
  }

  #passwordinput {
    display: none;
  }

  button {
    width: 100%;
    padding: 10px;
    font-size: 1.1em;
    border-radius: 6px;
    background-color: #3f51b5;
    color: white;
    border: none;
    cursor: pointer;
    margin-top: 12px;
  }

  button:hover {
    background-color: #303f9f;
  }

  .disclaimer {
    font-size: 0.8em;
    margin-top: 10px;
  }

  .disclaimer a {
    color: #003374;
    text-decoration: underline;
  }

  #infobox {
    font-size: 0.85em;
    color: #ea5906;
    margin: 4px 0 -2px 0;
  }

  @media (max-width: 420px) {
    .container {
      padding: 16px 12px;
      max-width: 92%;
    }
  }
</style>
</head>
<body>

  <!-- MENU HEADER -->
  <header class="nav-wrapper">
  <div class="nav-header">
    <div class="nav-title desktop-only">üí¨ Chat NebulaLounge ‚Äì <span class="header-subtitle">Dove tutto pu√≤ iniziare üõ∏</span></div>
    <div class="menu-links desktop-only">
  <a href="https://www.indelibile.it">üè† Home NebulaLounge</a>
  <a href="index.html">üöÄ Home Chat</a>
</div>

    <!-- Mobile layout -->
<div class="mobile-only">
  <div class="nav-toggle" onclick="document.body.classList.toggle('menu-open')">
    <span class="hamburger-icon">‚ò∞</span>
  </div>
  <span class="nav-title">Nebula Chat</span>
  <img src="https://www.indelibile.it/wp-content/uploads/2025/06/Logo-60x60-1.gif" alt="Logo Nebula" class="nav-logo" />
</div>

<!-- Mobile menu -->
<ul class="nav-menu mobile-only">
  <li><a href="https://www.indelibile.it">üè† <span>Home NebulaLounge</span></a></li>
  <li><a href="index.html">üöÄ <span>Home Chat</span></a></li>
</ul>


</header>

  <div class="cover">
    <h1>Accedi alla NebulaLounge üöÄ Gratis</h1>

    <div class="container">
      <div class="banner">
        <a href="https://tc.tradetracker.net/?c=18031&m=2469548&a=432856&r=&u=" target="_blank" rel="sponsored nofollow">
          <img src="https://ti.tradetracker.net/?c=18031&m=2469548&a=432856&r=&t=html"
            width="300" height="250" alt="Happy Card Feltrinelli" />
        </a>
      </div>

      <input type="text" id="nickinput" placeholder="Nickname *" required />
      <div id="infobox"></div>

      <input type="password" id="passwordinput" placeholder="Password (se registrato)" />

      <div class="select-row">
        <select id="sexselect" aria-label="Sono">
          <option value="">*Sono: ‚ôÇÔ∏è ‚ôÄÔ∏è</option>
          <option value="M">üë®‚Äçüíº Uomo ‚ôÇÔ∏è</option>
          <option value="F">üë©‚Äçüéì Donna ‚ôÄÔ∏è</option>
        </select>

        <select id="lookingselect" aria-label="Cerco">
          <option value="">*Cerco: ‚ôÄÔ∏è ‚ôÇÔ∏è</option>
          <option value="F">üë© Donna ‚ôÄÔ∏è</option>
          <option value="M">üë® Uomo ‚ôÇÔ∏è</option>
        </select>
      </div>

      <input type="text" id="cityinput" placeholder="Citt√† (opzionale)" />

      <button onclick="vaiAllaVerifica()">Entra in Chat</button>

      <div class="disclaimer">
        Accedendo accetti le <a href="disclaimer.html" target="_blank">regole di Simosnap</a>
      </div>
    </div>
  </div>

<script>
  window.onload = function () {
    const nickInput = document.getElementById("nickinput");
    const passwordInput = document.getElementById("passwordinput");
    const infoBox = document.getElementById("infobox");
    const cityInput = document.getElementById("cityinput");

    const menu = document.querySelector('.nav-menu');
    const menuButton = document.querySelector('.nav-toggle');

    // üîÑ Chiusura menu hamburger cliccando fuori (desktop + mobile)
    ['click', 'touchstart'].forEach(eventName => {
      document.addEventListener(eventName, function (event) {
        if (
          document.body.classList.contains('menu-open') &&
          !menu.contains(event.target) &&
          !menuButton.contains(event.target)
        ) {
          document.body.classList.remove('menu-open');
        }
      });

      // ‚ö†Ô∏è Evita che clic interni chiudano il menu
      menu.addEventListener(eventName, function (e) {
        e.stopPropagation();
      });
    });

    let nickIsRegistered = false;
    let delayCheck;
    let validCities = [];

    function sanitizeNick(nick) {
      return nick
        .toLowerCase()
        .replace(/\s+/g, "_")
        .replace(/[^a-z0-9_]/g, "")
        .slice(0, 25);
    }

    nickInput.addEventListener("input", () => {
      clearTimeout(delayCheck);
      delayCheck = setTimeout(() => {
        let rawNick = nickInput.value.trim();
        let nick = sanitizeNick(rawNick);
        nickInput.value = nick;

        if (nick === "") {
          nickIsRegistered = false;
          passwordInput.style.display = "none";
          passwordInput.value = "";
          infoBox.textContent = "";
          return;
        }

        fetch(`https://www.simosnap.org/rest/service.php/checknick/${nick}`)
          .then(res => res.json())
          .then(data => {
            if (data.registered === "yes") {
              nickIsRegistered = true;
              passwordInput.style.display = "block";
              infoBox.innerHTML = `<span style="color:#b10303;"><b>üîê Il nickname √® registrato.</b><br>Inserisci la password per autenticarti.</span>`;
            } else {
              nickIsRegistered = false;
              passwordInput.style.display = "none";
              passwordInput.value = "";
              infoBox.textContent = "";
            }
          })
          .catch(err => {
            console.error("Errore nella verifica del nick:", err);
            nickIsRegistered = false;
            passwordInput.style.display = "none";
            passwordInput.value = "";
            infoBox.textContent = "";
          });
      }, 500);
    });

    function setupAutocomplete(cities) {
      validCities = cities;
      const suggestionBox = document.createElement("div");
      suggestionBox.id = "citySuggestions";
      document.body.appendChild(suggestionBox);

      cityInput.addEventListener("input", () => {
        const val = cityInput.value.toLowerCase();
        const matches = cities.filter(c => c.toLowerCase().startsWith(val)).slice(0, 10);

        suggestionBox.innerHTML = "";
        if (val && matches.length) {
          const rect = cityInput.getBoundingClientRect();
          suggestionBox.style.top = rect.bottom + window.scrollY + "px";
          suggestionBox.style.left = rect.left + window.scrollX + "px";
          suggestionBox.style.width = rect.width + "px";
          suggestionBox.style.position = "absolute";
          suggestionBox.style.background = "#fff";
          suggestionBox.style.border = "1px solid #ccc";
          suggestionBox.style.zIndex = "1000";

          matches.forEach(city => {
            const item = document.createElement("div");
            item.textContent = city;
            item.style.padding = "6px";
            item.style.cursor = "pointer";
            item.addEventListener("click", () => {
              cityInput.value = city;
              suggestionBox.innerHTML = "";
            });
            suggestionBox.appendChild(item);
          });
        } else {
          suggestionBox.innerHTML = "";
        }
      });
    }

    function validateCity(city) {
      const val = city.trim().toLowerCase();
      return validCities.some(c => c.toLowerCase() === val);
    }

    window.vaiAllaVerifica = function () {
      const nick = sanitizeNick(nickInput.value.trim());
      const sex = document.getElementById("sexselect").value;
      const looking = document.getElementById("lookingselect").value;
      const city = cityInput.value.trim();
      const password = passwordInput.value;

      if (!nick || nick.length < 3) {
        alert("‚ö†Ô∏è Inserisci un nickname valido (minimo 3 caratteri).");
        return;
      }

      if (!sex || !looking) {
        alert("‚ö†Ô∏è Seleziona sesso e preferenza.");
        return;
      }

      if (nickIsRegistered && !password) {
        alert("‚ö†Ô∏è Il nickname √® registrato. Inserisci la password per continuare.");
        return;
      }

      if (city && !validateCity(city)) {
        alert("‚ö†Ô∏è Inserisci una citt√† valida.");
        return;
      }

      localStorage.setItem("nick", nick);
      localStorage.setItem("sex", sex);
      localStorage.setItem("looking", looking);
      localStorage.setItem("city", city);
      if (password) localStorage.setItem("password", password);

      window.location.href = "join.html";
    };

    fetch("https://nebula-chat-silk.vercel.app/comuni.json")
      .then(res => res.json())
      .then(data => {
        const cities = data.map(c => c.nome);
        setupAutocomplete(cities);
      })
      .catch(err => console.error("Errore nel caricamento dei comuni:", err));
  };
</script>
</body>
</html>
