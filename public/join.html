<script>
  function capitalize(str) {
    return str
      ? str.split(" ").map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(" ")
      : "";
  }

  window.onload = function () {
    const nick = localStorage.getItem("nick") || "Guest";
    const sex = localStorage.getItem("sex") || "";
    const looking = localStorage.getItem("looking") || "";
    const city = localStorage.getItem("city") || "";
    const password = localStorage.getItem("password") || "";

    document.getElementById("nickField").value = nick;
    document.getElementById("sexField").value = sex;
    document.getElementById("cityField").value = city;
    document.getElementById("passwordField").value = password;

    const sexText     = sex === "M" ? "un 👨‍💼 Uomo ♂️" : sex === "F" ? "una 👩 Donna ♀️" : "un* utente";
    const lookingText = looking === "M" ? "un 👨‍💼 Uomo ♂️" : looking === "F" ? "una 👩 Donna ♀️" : "qualcuno";
    const cityText    = city ? `dalla città di 📍${capitalize(city)}` : "da una località sconosciuta 🕵️";

    document.getElementById("nickSpan").textContent = capitalize(nick);
    document.getElementById("sexSpan").textContent = sexText;
    document.getElementById("lookingSpan").textContent = lookingText;
    document.getElementById("citySpan").textContent = cityText;

    // Nascondi step 1 dopo 8s, mostra step 2
    setTimeout(() => {
      const step1 = document.getElementById("welcomeStep1");
      const step2 = document.getElementById("welcomeStep2");
      step1.style.opacity = "0";
      setTimeout(() => {
        step1.style.display = "none";
        step2.style.display = "block";
        step2.style.opacity = "1";
        step2.querySelector(".welcomeDetails").style.display = "block";
      }, 1000);
    }, 8000);

    // Invio automatico del form dopo 1 secondo
    setTimeout(() => {
      document.getElementById("chatForm").submit();
    }, 1000);

    // Audio dopo 11 secondi
    setTimeout(() => {
      const audio = document.getElementById("welcomeAudio");
      audio.play().catch(err => console.warn("Audio bloccato:", err));
    }, 11000);

    // Nascondi step 2 e mostra banner top dopo 45s
    setTimeout(() => {
      const step2 = document.getElementById("welcomeStep2");
      step2.style.opacity = "0";
      setTimeout(() => {
        step2.style.display = "none";
        document.getElementById("bannerTop").style.display = "flex";
      }, 1000);
    }, 45000);
  };
</script>
