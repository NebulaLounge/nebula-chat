<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NebulaLounge ‚Äì Connessione</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #0b132b;
      color: #eee;
    }

    .container {
      width: 100%;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0;
    }

    #welcomeTop {
      width: 100%;
      height: 90px;
      background: linear-gradient(to right, #001f3f 0%, #142a4d 40%, #142a4d 60%, #001f3f 100%);
      padding: 0 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.3rem;
      font-weight: 600;
      text-align: center;
      color: #f0e8de;
      box-shadow: inset 0 0 22px #ea5906aa;
      margin: 0;
      transition: opacity 1s ease;
    }

    .frame-banner {
      width: 100%;
      height: 90px;
      margin: 0;
      background: linear-gradient(to right, #001f3f 0%, #0b132b 40%, #0b132b 60%, #001f3f 100%);
      display: none;
      justify-content: center;
      align-items: center;
      box-shadow: inset 0 0 22px rgba(234, 89, 6, 0.4);
    }

    iframe.chat {
      border: none;
      width: 100%;
      max-width: 1080px;
      height: 700px;
      background: #000;
      box-shadow: 0 0 14px rgba(0,0,0,0.4);
    }

    .banner-bottom {
      width: 100%;
      height: 90px;
      margin: 0;
      background: linear-gradient(to right, #001f3f 0%, #0b132b 40%, #0b132b 60%, #001f3f 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: inset 0 0 22px rgba(234, 89, 6, 0.4);
    }

    form { display: none; }

    @media (max-width: 768px) {
      #welcomeTop { font-size: 1.05rem; padding: 0 8px; }
      iframe.chat { height: 540px; }
    }
  </style>
</head>
<body>

  <div class="container">

    <!-- Benvenuto iniziale -->
    <div id="welcomeTop">
      üåå Benvenuto su&nbsp;<strong>NebulaLounge</strong>! Ciao il tuo Nick √® <span id="nickSpan"></span>, sei&nbsp; <span id="sexSpan"></span> che cerca&nbsp; <span id="lookingSpan"></span>&nbsp;<span id="citySpan"></span>.
    </div>

    <!-- Banner superiore -->
    <div class="frame-banner" id="bannerTop">
      <iframe
        src="https://rotator.tradetracker.net/?r=97208&amp;t=iframe"
        width="728" height="90"
        style="border:0; margin:0; padding:0;"
        frameborder="0" scrolling="no"
        title="Banner pubblicitario">
      </iframe>
    </div>

    <!-- Form nascosto -->
    <form id="chatForm" action="https://kw-rr.simosnap.com/login.php" method="post" target="chatFrame">
      <input type="hidden" name="nick" id="nickField" />
      <input type="hidden" name="sex" id="sexField" />
      <input type="hidden" name="looking" id="lookingField" />
      <input type="hidden" name="location" id="cityField" />
      <input type="hidden" name="password" id="passwordField" />
      <input type="hidden" name="channel" value="#NebulaLounge" />
    </form>

    <!-- Chat frame -->
    <iframe class="chat" name="chatFrame" id="chatFrame" title="Chat NebulaLounge"></iframe>

  </div>

  <!-- Banner inferiore -->
  <div class="banner-bottom">
    <iframe
      src="https://rotator.tradetracker.net/?r=97208&amp;t=iframe"
      width="728" height="90"
      style="border:0; margin:0; padding:0;"
      frameborder="0" scrolling="no"
      title="Banner pubblicitario">
    </iframe>
  </div>

  <!-- Audio benvenuto -->
  <audio id="welcomeAudio" preload="auto" src="https://www.indelibile.it/wp-content/uploads/2025/07/simple-notification-152054.mp3"></audio>

  <script>
  let registeredNicks = [];
  let welcomeMessage = "";

  // Carica config.json
  fetch("config.json")
    .then(response => response.json())
    .then(config => {
      registeredNicks = config.registeredNicks || [];
      welcomeMessage = config.welcomeMessage || "";
      mostraMessaggioBenvenuto();
    });

  function mostraMessaggioBenvenuto() {
    const infoBox = document.getElementById("infobox");
    if (welcomeMessage) {
      infoBox.textContent = welcomeMessage;
    }
  }

  function sanitizeNick(nick) {
    return nick
      .normalize("NFD")
      .replace(/[\u0300-\u036f]/g, "")
      .trim()
      .replace(/\s+/g, "_")
      .replace(/[^\w-]/g, "")
      .toLowerCase();
  }

  function isRegisteredNick(nickSanitized) {
    return registeredNicks
      .map(n => sanitizeNick(n))
      .includes(nickSanitized);
  }

  function updatePasswordVisibility(nickInput) {
    const nickSanitized = sanitizeNick(nickInput);
    const passwordInput = document.getElementById('passwordinput');
    const infoBox = document.getElementById('infobox');

    if (isRegisteredNick(nickSanitized)) {
      passwordInput.style.display = 'block';
      infoBox.textContent = "üîê Nick registrato. Inserisci la password.";
    } else {
      passwordInput.style.display = 'none';
      passwordInput.value = "";
      infoBox.textContent = welcomeMessage || "";
    }
  }

  document.getElementById('nickinput').addEventListener('input', function () {
    updatePasswordVisibility(this.value);
  });

  function vaiAllaVerifica() {
    const rawNick = document.getElementById('nickinput').value;
    const nick = sanitizeNick(rawNick);
    const sex = document.getElementById('sexselect').value;
    const looking = document.getElementById('lookingselect').value;
    const city = document.getElementById('cityinput').value.trim();
    const password = document.getElementById('passwordinput').value;

    if (!nick || !sex || !looking) {
      alert("‚ö†Ô∏è Compila tutti i campi obbligatori.");
      return;
    }

    localStorage.setItem("nick", nick);
    localStorage.setItem("sex", sex);
    localStorage.setItem("looking", looking);
    localStorage.setItem("city", city);
    if (password) localStorage.setItem("password", password);

    window.location.href = "join.html";
  }
</script>

</body>
</html>
