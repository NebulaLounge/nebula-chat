<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NebulaLounge â€“ Connessione</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #0b132b;
      color: #eee;
    }

    .container {
      width: 100%;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0;
    }

    #welcomeStep1, #welcomeStep2 {
      width: 100%;
      height: 90px;
      background: linear-gradient(to right, #001f3f 0%, #142a4d 40%, #142a4d 60%, #001f3f 100%);
      padding: 0 16px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      color: #f0e8de;
      box-shadow: inset 0 0 22px #ea5906aa;
      margin: 0;
      transition: opacity 1s ease;
      overflow: hidden;
      box-sizing: border-box;
    }

    #welcomeStep1 .welcomeTitle,
    #welcomeStep2 .welcomeTitle {
      font-size: 2rem;
      font-weight: 700;
      color: #f0e8de;
      line-height: 1.2;
      margin-bottom: 4px;
    }

    #welcomeStep2 .welcomeDetails {
      font-size: 1.1rem;
      font-weight: 500;
      color: #f0e8de;
      line-height: 1.2;
      display: none;
    }

    .frame-banner {
      width: 100%;
      height: 90px;
      margin: 0;
      background: linear-gradient(to right, #001f3f 0%, #0b132b 40%, #0b132b 60%, #001f3f 100%);
      display: none;
      justify-content: center;
      align-items: center;
      box-shadow: inset 0 0 22px rgba(234, 89, 6, 0.4);
    }

    iframe.chat {
      border: none;
      width: 100%;
      max-width: 1080px;
      height: 700px;
      background: #000;
      box-shadow: 0 0 14px rgba(0,0,0,0.4);
    }

    .banner-bottom {
      width: 100%;
      height: 90px;
      margin: 0;
      background: linear-gradient(to right, #001f3f 0%, #0b132b 40%, #0b132b 60%, #001f3f 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: inset 0 0 22px rgba(234, 89, 6, 0.4);
    }

    form { display: none; }

   @media (max-width: 768px) {
  #welcomeStep1 .welcomeTitle,
  #welcomeStep2 .welcomeTitle {
    font-size: 1.2rem;
    padding: 0 12px;
  }

  #welcomeStep2 .welcomeDetails {
    font-size: 0.95rem;
  }

  #welcomeStep1, #welcomeStep2 {
    height: auto;
    padding-top: 12px;
    padding-bottom: 12px;
  }
}
  </style>
</head>
<body>

  <div class="container">

    <!-- Step 1 -->
    <div id="welcomeStep1">
      <div class="welcomeTitle">
        ðŸŒŒ Benvenuta/o â€“ Connessione attiva. Inizia il viaggio su <strong>NebulaLounge</strong>!
      </div>
    </div>

    <!-- Step 2 -->
    <div id="welcomeStep2" style="display: none;">
      <div class="welcomeTitle">
        ðŸš€ Benvenuto nella <strong>NebulaLounge</strong>! Lasciati ispirare.
      </div>
      <div class="welcomeDetails">
        Ciao <span id="nickSpan"></span>, sei <span id="sexSpan"></span> e stai cercando <span id="lookingSpan"></span> <span id="citySpan"></span>.
      </div>
    </div>

    <!-- Banner superiore -->
    <div class="frame-banner" id="bannerTop">
      <iframe
        src="https://rotator.tradetracker.net/?r=97208&amp;t=iframe"
        width="728" height="90"
        style="border:0; margin:0; padding:0;"
        frameborder="0" scrolling="no"
        title="Banner pubblicitario">
      </iframe>
    </div>

    <!-- Form nascosto -->
    <form id="chatForm" action="https://kw-rr.simosnap.com/login.php" method="post" target="chatFrame">
      <input type="hidden" name="nick" id="nickField" />
      <input type="hidden" name="sex" id="sexField" />
      <input type="hidden" name="looking" id="lookingField" />
      <input type="hidden" name="location" id="cityField" />
      <input type="hidden" name="password" id="passwordField" />
      <input type="hidden" name="channel" value="#NebulaLounge" />
    </form>

    <!-- Chat frame -->
    <iframe class="chat" name="chatFrame" id="chatFrame" title="Chat NebulaLounge"></iframe>

  </div>

  <!-- Banner inferiore -->
  <div class="banner-bottom">
    <iframe
      src="https://rotator.tradetracker.net/?r=97208&amp;t=iframe"
      width="728" height="90"
      style="border:0; margin:0; padding:0;"
      frameborder="0" scrolling="no"
      title="Banner pubblicitario">
    </iframe>
  </div>

  <!-- Audio benvenuto -->
  <audio id="welcomeAudio" preload="auto" src="https://www.indelibile.it/wp-content/uploads/2025/07/simple-notification-152054.mp3"></audio>

  <script>
  function capitalize(str) {
    return str
      ? str.split(" ").map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(" ")
      : "";
  }

  window.onload = function () {
    const nick = localStorage.getItem("nick") || "Guest";
    const sex = localStorage.getItem("sex") || "";
    const looking = localStorage.getItem("looking") || "";
    const city = localStorage.getItem("city") || "";
    const password = localStorage.getItem("password") || "";

    document.getElementById("nickField").value = nick;
    document.getElementById("sexField").value = sex;
    document.getElementById("lookingField").value = looking;
    document.getElementById("cityField").value = city;
    document.getElementById("passwordField").value = password;

    const sexText = sex === "M" ? "un ðŸ‘¨â€ðŸ’¼ Uomo â™‚ï¸" : sex === "F" ? "una ðŸ‘© Donna â™€ï¸" : "un* utente";
    const lookingText = looking === "M" ? "un ðŸ‘¨â€ðŸ’¼ Uomo â™‚ï¸" : looking === "F" ? "una ðŸ‘© Donna â™€ï¸" : "qualcuno";
    const cityText = city ? `dalla cittÃ  di ðŸ“${capitalize(city)}` : "da una localitÃ  sconosciuta ðŸ•µï¸";

    document.getElementById("nickSpan").textContent = capitalize(nick);
    document.getElementById("sexSpan").textContent = sexText;
    document.getElementById("lookingSpan").textContent = lookingText;
    document.getElementById("citySpan").textContent = cityText;

    setTimeout(() => {
      const step1 = document.getElementById("welcomeStep1");
      const step2 = document.getElementById("welcomeStep2");

      step1.style.opacity = "0";

      setTimeout(() => {
        step1.style.display = "none";
        step2.style.display = "flex";
        step2.querySelector(".welcomeDetails").style.display = "block";
      }, 1000);
    }, 7000);

    fetch("config.json")
      .then(response => response.json())
      .then(config => {
        document.querySelector('input[name="channel"]').value = config.channel || "#NebulaLounge";

        if (config.welcomeMessage) {
          const extraMessage = document.createElement("div");
          extraMessage.id = "extraWelcome";
          extraMessage.innerHTML = `<em>${config.welcomeMessage}</em>`;
                   extraMessage.style.cssText = "margin-top:12px; font-size:1rem; color:#ea5906;";
          document.body.appendChild(extraMessage);
        }
      })
      .catch(err => console.warn("Errore nel caricamento di config.json:", err));

    // Invia il form per caricare la chat
    document.getElementById("chatForm").submit();

    // Audio dopo 8s con log
    setTimeout(() => {
      const audio = document.getElementById("welcomeAudio");
      audio.play().then(() => {
        console.log("Audio riprodotto.");
      }).catch(err => {
        console.warn("Audio bloccato:", err);
      });
    }, 8000);

    // Dopo 24s sostituisci il secondo step con il banner
    setTimeout(() => {
      const step2 = document.getElementById("welcomeStep2");
      step2.style.opacity = "0";

      setTimeout(() => {
        step2.style.display = "none";
        document.getElementById("bannerTop").style.display = "flex";
      }, 1000);
    }, 24000);
  };
  </script>

  <!-- Autocompletamento cittÃ  -->
  <script>
    function setupAutocomplete(cities) {
      const input = document.getElementById("cityField");
      const suggestionBox = document.createElement("div");
      suggestionBox.style.cssText = "position:absolute; background:#fff; color:#000; border:1px solid #ccc; z-index:1000; max-height:200px; overflow-y:auto; font-size:0.95rem;";
      suggestionBox.id = "citySuggestions";
      document.body.appendChild(suggestionBox);

      input.addEventListener("input", () => {
        const val = input.value.toLowerCase();
        const matches = cities.filter(c => c.toLowerCase().startsWith(val)).slice(0, 10);

        suggestionBox.innerHTML = "";
        if (val && matches.length) {
          const rect = input.getBoundingClientRect();
          suggestionBox.style.top = rect.bottom + window.scrollY + "px";
          suggestionBox.style.left = rect.left + window.scrollX + "px";
          suggestionBox.style.width = rect.width + "px";

          matches.forEach(city => {
            const item = document.createElement("div");
            item.textContent = city;
            item.style.padding = "6px";
            item.style.cursor = "pointer";
            item.addEventListener("click", () => {
              input.value = city;
              suggestionBox.innerHTML = "";
              localStorage.setItem("city", city);
            });
            suggestionBox.appendChild(item);
          });
        } else {
          suggestionBox.innerHTML = "";
        }
      });
    }

    fetch("https://nebula-chat-silk.vercel.app/comuni.json")
      .then(res => res.json())
      .then(data => {
        const cities = data.map(c => c.nome);
        setupAutocomplete(cities);
      })
      .catch(err => console.error("Errore nel caricamento dei comuni:", err));
  </script>

</body>
</html>
