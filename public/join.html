<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NebulaLounge – Connessione</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #0b132b;
      color: #f0e8de;
    }

    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    #welcomeStep1, #welcomeStep2 {
      width: 100%;
      padding: 16px;
      text-align: center;
      background: linear-gradient(to right, #001f3f, #142a4d, #001f3f);
      box-shadow: inset 0 0 22px #ea5906aa;
      transition: opacity 1s ease;
    }

    #welcomeStep1 .welcomeTitle,
    #welcomeStep2 .welcomeTitle {
      font-size: 2rem;
      font-weight: 700;
    }

    #welcomeStep2 .welcomeDetails {
      font-size: 1.1rem;
      font-weight: 500;
      display: none;
      margin-top: 8px;
    }

    .frame-banner {
      display: none;
      justify-content: center;
      align-items: center;
      height: 90px;
      width: 100%;
      background: linear-gradient(to right, #001f3f, #0b132b, #001f3f);
      box-shadow: inset 0 0 22px rgba(234, 89, 6, 0.4);
    }

    .chat {
      border: none;
      width: 100vw;
      height: calc(100vh - 180px);
      display: none;
    }

    .chat-loading {
      padding: 16px;
      font-size: 1.2rem;
      text-align: center;
    }

    .banner-bottom {
      width: 100%;
      height: 90px;
      margin-top: 16px;
      background: linear-gradient(to right, #001f3f, #0b132b, #001f3f);
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: inset 0 0 22px rgba(234, 89, 6, 0.4);
    }
  </style>
</head>
<body>

<div class="container">
  <!-- Saluto 1 -->
  <div id="welcomeStep1">
    <div class="welcomeTitle">
      🌌 Benvenuta/o – Connessione attiva. Inizia il viaggio su <strong>NebulaLounge</strong>!
    </div>
  </div>

  <!-- Saluto 2 -->
  <div id="welcomeStep2" style="display: none;">
    <div class="welcomeTitle">🚀 Benvenuto nella <strong>NebulaLounge</strong>! Lasciati ispirare.</div>
    <div class="welcomeDetails">
      Ciao <span id="nickSpan"></span>, sei <span id="sexSpan"></span> e stai cercando <span id="lookingSpan"></span> <span id="citySpan"></span>.
    </div>
  </div>

  <!-- Banner superiore -->
  <div class="frame-banner" id="bannerTop">
    <iframe
      src="https://rotator.tradetracker.net/?r=97208&t=iframe"
      width="728" height="90"
      style="border:0; margin:0; padding:0;"
      frameborder="0" scrolling="no"
      title="Banner pubblicitario">
    </iframe>
  </div>

  <!-- Loading -->
  <div class="chat-loading" id="chatLoading">💬 Connessione in corso...</div>

  <!-- Chat -->
  <iframe class="chat" id="chatFrame" title="Chat NebulaLounge"></iframe>
</div>

<!-- Banner inferiore -->
<div class="banner-bottom">
  <iframe
    src="https://rotator.tradetracker.net/?r=97208&t=iframe"
    width="728" height="90"
    style="border:0; margin:0; padding:0;"
    frameborder="0" scrolling="no"
    title="Banner pubblicitario">
  </iframe>
</div>

<!-- Audio -->
<audio id="welcomeAudio" preload="auto" src="assets/welcome.mp3"></audio>

<script>
  function capitalize(str) {
    return str
      ? str.split(" ").map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(" ")
      : "";
  }

  window.onload = function () {
    const nick = localStorage.getItem("nick") || "Guest" + Math.floor(Math.random() * 1000);
    const sex = localStorage.getItem("sex") || "";
    const looking = localStorage.getItem("looking") || "";
    const city = localStorage.getItem("city") || "";

    const sexText = sex === "M" ? "un 👨‍💼 Uomo ♂️" : sex === "F" ? "una 👩 Donna ♀️" : "un* utente";
    const lookingText = looking === "M" ? "un 👨‍💼 Uomo ♂️" : looking === "F" ? "una 👩 Donna ♀️" : "qualcuno";
    const cityText = city ? `dalla città di 📍${capitalize(city)}` : "da una località sconosciuta 🕵️";

    document.getElementById("nickSpan").textContent = capitalize(nick);
    document.getElementById("sexSpan").textContent = sexText;
    document.getElementById("lookingSpan").textContent = lookingText;
    document.getElementById("citySpan").textContent = cityText;

    // Animazioni welcome
    setTimeout(() => {
      const step1 = document.getElementById("welcomeStep1");
      const step2 = document.getElementById("welcomeStep2");
      step1.style.opacity = "0";
      setTimeout(() => {
        step1.style.display = "none";
        step2.style.display = "block";
        step2.querySelector(".welcomeDetails").style.display = "block";
      }, 1000);
    }, 7000);

    // Audio
    setTimeout(() => {
      const audio = document.getElementById("welcomeAudio");
      audio.play().catch(err => console.warn("Audio bloccato:", err));
    }, 8000);

    // Banner top
    setTimeout(() => {
      const step2 = document.getElementById("welcomeStep2");
      step2.style.opacity = "0";
      setTimeout(() => {
        step2.style.display = "none";
        document.getElementById("bannerTop").style.display = "flex";
      }, 1000);
    }, 24000);

    // Caricamento iframe chat
    const chatURL = `https://kiwi.simosnap.com/?nick=${encodeURIComponent(nick)}&channel=%23NebulaLounge&theme=basic`;
    const iframe = document.getElementById("chatFrame");
    const loading = document.getElementById("chatLoading");

    iframe.src = chatURL;
    iframe.onload = () => {
      loading.style.display = "none";
      iframe.style.display = "block";
    };
  };
</script>

</body>
</html>
